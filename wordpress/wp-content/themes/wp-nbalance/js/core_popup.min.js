!function(t){function e(t,i){if(t===!1){if(n&&n.length>0){for(var s=0;s<n.length;s++)n[s]();n=null,o=-1}}else null===n&&(n=[],o=-1,BX.defer(e)(!1)),t>o?(o=t,n=[i]):t==o&&n.push(i)}if(!BX.PopupWindowManager){BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(t,e,o){var n=-1;if((n=this._getPopupIndex(t))!==-1)return this._popups[n];var i=new BX.PopupWindow(t,e,o);return BX.addCustomEvent(i,"onPopupShow",BX.delegate(this.onPopupShow,this)),BX.addCustomEvent(i,"onPopupClose",BX.delegate(this.onPopupClose,this)),BX.addCustomEvent(i,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this)),this._popups.push(i),i},onPopupShow:function(t){null!==this._currentPopup&&this._currentPopup.close(),this._currentPopup=t},onPopupClose:function(t){this._currentPopup=null},onPopupDestroy:function(t){var e=-1;(e=this._getPopupIndex(t.uniquePopupId))!==-1&&(this._popups=BX.util.deleteFromArray(this._popups,e))},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(t){return this._getPopupIndex(t)!==-1},_getPopupIndex:function(t){for(var e=-1,o=0;o<this._popups.length;o++)if(this._popups[o].uniquePopupId==t)return o;return e}},BX.PopupWindow=function(e,o,n){if(BX.onCustomEvent("onPopupWindowInit",[e,o,n]),this.uniquePopupId=e,this.params=n||{},this.params.zIndex=parseInt(this.params.zIndex),this.params.zIndex=isNaN(this.params.zIndex)?0:this.params.zIndex,this.buttons=this.params.buttons&&BX.type.isArray(this.params.buttons)?this.params.buttons:[],this.offsetTop=BX.PopupWindow.getOption("offsetTop"),this.offsetLeft=BX.PopupWindow.getOption("offsetLeft"),this.firstShow=!1,this.bordersWidth=20,this.bindElementPos=null,this.closeIcon=null,this.angle=null,this.overlay=null,this.titleBar=null,this.bindOptions="object"==typeof this.params.bindOptions?this.params.bindOptions:{},this.isAutoHideBinded=!1,this.closeByEsc=!!this.params.closeByEsc,this.isCloseByEscBinded=!1,this.params.parentPopup instanceof BX.PopupWindow?(this.parentPopup=this.params.parentPopup,this.appendContainer=this.params.parentPopup.contentContainer,this.params.offsetTop=(this.params.offsetTop?this.params.offsetTop:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetTop),this.params.offsetLeft=(this.params.offsetLeft?this.params.offsetLeft:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetLeft)):(this.parentPopup=null,this.appendContainer=document.body),this.dragged=!1,this.dragPageX=0,this.dragPageY=0,this.params.events)for(var i in this.params.events)BX.addCustomEvent(this,i,this.params.events[i]);n.darkMode&&BX.addClass(this.popupContainer,"popup-window-dark");var s="popup-window";n.contentColor&&BX.type.isNotEmptyString(n.contentColor)&&(s+=" popup-window-content-"+n.contentColor),n.contentNoPaddings&&(s+=" popup-window-content-no-paddings"),n.noAllPaddings&&(s+=" popup-window-no-paddings"),n.titleBar&&(s+=" popup-window-with-titlebar"),n.className&&BX.type.isNotEmptyString(n.className)&&(s+=" "+n.className),n.darkMode&&(s+=" popup-window-dark"),this.popupContainer=document.createElement("DIV");var p="popup-window-titlebar-"+e;n.titleBar&&(this.titleBar=BX.create("div",{props:{className:"popup-window-titlebar",id:p}})),n.closeIcon&&(this.closeIcon=BX.create("a",{props:{className:"popup-window-close-icon"+(n.titleBar?" popup-window-titlebar-close-icon":""),href:""},style:"object"==typeof n.closeIcon?n.closeIcon:{},events:{click:BX.proxy(this._onCloseIconClick,this)}}),BX.browser.IsIE()&&BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})),this.contentContainer=BX.create("div",{props:{id:"popup-window-content-"+e,className:"popup-window-content"}}),BX.adjust(this.popupContainer,{props:{id:e,className:s},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"},children:[this.titleBar,this.contentContainer,this.closeIcon]}),this.appendContainer.appendChild(this.popupContainer),this.buttonsContainer=null,n.angle&&this.setAngle(n.angle),n.overlay&&this.setOverlay(n.overlay),this.setOffset(this.params),this.setBindElement(o),this.setTitleBar(this.params.titleBar),this.setContent(this.params.content),this.setButtons(this.params.buttons),this.params.bindOnResize!==!1&&BX.bind(t,"resize",BX.proxy(this._onResizeWindow,this))},BX.PopupWindow.prototype.setContent=function(t){this.contentContainer&&t&&(BX.type.isElementNode(t)?(BX.cleanNode(this.contentContainer),this.contentContainer.appendChild(t.parentNode?t.parentNode.removeChild(t):t),t.style.display="block"):BX.type.isString(t)?this.contentContainer.innerHTML=t:this.contentContainer.innerHTML="&nbsp;")},BX.PopupWindow.prototype.setButtons=function(t){if(this.buttons=t&&BX.type.isArray(t)?t:[],this.buttonsContainer&&BX.remove(this.buttonsContainer),this.buttons.length>0&&this.contentContainer){for(var e=[],o=0;o<this.buttons.length;o++){var n=this.buttons[o];null!=n&&BX.is_subclass_of(n,BX.PopupWindowButton)&&(n.popupWindow=this,e.push(n.render()))}this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:e}))}},BX.PopupWindow.prototype.setBindElement=function(t){t&&"object"==typeof t&&(BX.type.isDomNode(t)||BX.type.isNumber(t.top)&&BX.type.isNumber(t.left)?this.bindElement=t:BX.type.isNumber(t.clientX)&&BX.type.isNumber(t.clientY)&&(BX.fixEventPageXY(t),this.bindElement={left:t.pageX,top:t.pageY,bottom:t.pageY}))},BX.PopupWindow.prototype.getBindElementPos=function(t){if(BX.type.isDomNode(t))return BX.pos(t,!1);if(t&&"object"==typeof t)return BX.type.isNumber(t.bottom)||(t.bottom=t.top),t;var e=BX.GetWindowInnerSize(),o=BX.GetWindowScrollPos(),n=this.popupContainer.offsetWidth,i=this.popupContainer.offsetHeight;return this.bindOptions.forceTop=!0,{left:e.innerWidth/2-n/2+o.scrollLeft,top:e.innerHeight/2-i/2+o.scrollTop,bottom:e.innerHeight/2-i/2+o.scrollTop,windowSize:e,windowScroll:o,popupWidth:n,popupHeight:i}},BX.PopupWindow.prototype.setAngle=function(t){var e="popup-window-angly";if(null==this.angle){var o=this.bindOptions.position&&"top"==this.bindOptions.position?"bottom":"top",n=BX.PopupWindow.getOption("top"==o?"angleMinTop":"angleMinBottom"),i=BX.type.isNumber(t.offset)?t.offset:0,s=BX.PopupWindow.getOption("angleLeftOffset",null);i>0&&BX.type.isNumber(s)&&(i+=s-BX.PopupWindow.defaultOptions.angleLeftOffset),this.angle={element:BX.create("div",{props:{className:e+" "+e+"-"+o}}),position:o,offset:0,defaultOffset:Math.max(i,n)},this.popupContainer.appendChild(this.angle.element)}if("object"==typeof t&&t.position&&BX.util.in_array(t.position,["top","right","bottom","left","hide"])&&(BX.removeClass(this.angle.element,e+"-"+this.angle.position),BX.addClass(this.angle.element,e+"-"+t.position),this.angle.position=t.position),"object"==typeof t&&BX.type.isNumber(t.offset)){var p,a,u=t.offset;"top"==this.angle.position?(p=BX.PopupWindow.getOption("angleMinTop"),a=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxTop"),a=a<p?Math.max(p,u):a,this.angle.offset=Math.min(Math.max(p,u),a),this.angle.element.style.left=this.angle.offset+"px",this.angle.element.style.marginLeft=0):"bottom"==this.angle.position?(p=BX.PopupWindow.getOption("angleMinBottom"),a=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxBottom"),a=a<p?Math.max(p,u):a,this.angle.offset=Math.min(Math.max(p,u),a),this.angle.element.style.marginLeft=this.angle.offset+"px",this.angle.element.style.left=0):"right"==this.angle.position?(p=BX.PopupWindow.getOption("angleMinRight"),a=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxRight"),a=a<p?Math.max(p,u):a,this.angle.offset=Math.min(Math.max(p,u),a),this.angle.element.style.top=this.angle.offset+"px"):"left"==this.angle.position&&(p=BX.PopupWindow.getOption("angleMinLeft"),a=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxLeft"),a=a<p?Math.max(p,u):a,this.angle.offset=Math.min(Math.max(p,u),a),this.angle.element.style.top=this.angle.offset+"px")}},BX.PopupWindow.prototype.isTopAngle=function(){return null!=this.angle&&"top"==this.angle.position},BX.PopupWindow.prototype.isBottomAngle=function(){return null!=this.angle&&"bottom"==this.angle.position},BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return null!=this.angle&&BX.util.in_array(this.angle.position,["top","bottom"])},BX.PopupWindow.prototype.getAngleHeight=function(){return this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0},BX.PopupWindow.prototype.setOffset=function(t){"object"==typeof t&&(t.offsetLeft&&BX.type.isNumber(t.offsetLeft)&&(this.offsetLeft=t.offsetLeft+BX.PopupWindow.getOption("offsetLeft")),t.offsetTop&&BX.type.isNumber(t.offsetTop)&&(this.offsetTop=t.offsetTop+BX.PopupWindow.getOption("offsetTop")))},BX.PopupWindow.prototype.setTitleBar=function(t){this.titleBar&&("object"==typeof t&&BX.type.isDomNode(t.content)?(this.titleBar.innerHTML="",this.titleBar.appendChild(t.content)):"string"==typeof t&&(this.titleBar.innerHTML="",this.titleBar.appendChild(BX.create("span",{props:{className:"popup-window-titlebar-text"},text:t}))),this.params.draggable&&(this.titleBar.style.cursor="move",BX.bind(this.titleBar,"mousedown",BX.proxy(this._startDrag,this))))},BX.PopupWindow.prototype.setClosingByEsc=function(t){t=!!t,t?(this.closeByEsc=!0,this.isCloseByEscBinded||(BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!0)):(this.closeByEsc=!1,this.isCloseByEscBinded&&(BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!1))},BX.PopupWindow.prototype.setOverlay=function(t){null==this.overlay&&(this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})},this.adjustOverlayZindex(),this.resizeOverlay(),this.appendContainer.appendChild(this.overlay.element)),t&&t.opacity&&BX.type.isNumber(t.opacity)&&t.opacity>=0&&t.opacity<=100&&(BX.browser.IsIE()&&!BX.browser.IsIE9()?this.overlay.element.style.filter="alpha(opacity="+t.opacity+")":(this.overlay.element.style.filter="none",this.overlay.element.style.opacity=parseFloat(t.opacity/100).toPrecision(3))),t&&t.backgroundColor&&(this.overlay.element.style.backgroundColor=t.backgroundColor)},BX.PopupWindow.prototype.removeOverlay=function(){null!=this.overlay&&null!=this.overlay.element&&BX.remove(this.overlay.element),this.overlay=null},BX.PopupWindow.prototype.hideOverlay=function(){null!=this.overlay&&null!=this.overlay.element&&(this.overlay.element.style.display="none")},BX.PopupWindow.prototype.showOverlay=function(){null!=this.overlay&&null!=this.overlay.element&&(this.overlay.element.style.display="block")},BX.PopupWindow.prototype.resizeOverlay=function(){if(null!=this.overlay&&null!=this.overlay.element)if(this.parentPopup)this.overlay.element.style.width=this.parentPopup.popupContainer.offsetWidth+"px",this.overlay.element.style.height=this.parentPopup.popupContainer.offsetHeight+"px";else{var t=BX.GetWindowScrollSize(),e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=t.scrollWidth+"px",this.overlay.element.style.height=e+"px"}},BX.PopupWindow.prototype.getZindex=function(){return null!=this.overlay?BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex},BX.PopupWindow.prototype.adjustOverlayZindex=function(){null!=this.overlay&&null!=this.overlay.element&&(this.overlay.element.style.zIndex=parseInt(this.popupContainer.style.zIndex)-1)},BX.PopupWindow.prototype.show=function(){this.firstShow||(BX.onCustomEvent(this,"onPopupFirstShow",[this]),this.firstShow=!0),BX.onCustomEvent(this,"onPopupShow",[this]),this.showOverlay(),this.popupContainer.style.display="block",this.adjustPosition(),BX.onCustomEvent(this,"onAfterPopupShow",[this]),this.closeByEsc&&!this.isCloseByEscBinded&&(BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!0),this.params.autoHide&&!this.isAutoHideBinded&&setTimeout(BX.proxy(function(){this.isShown()&&(this.isAutoHideBinded=!0,BX.bind(this.popupContainer,"click",this.cancelBubble),BX.bind(document,"click",BX.proxy(this.close,this)))},this),100)},BX.PopupWindow.prototype.isShown=function(){return"block"==this.popupContainer.style.display},BX.PopupWindow.prototype.cancelBubble=function(e){e||(e=t.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},BX.PopupWindow.prototype.close=function(t){if(this.isShown()){if(t&&!(BX.getEventButton(t)&BX.MSLEFT))return!0;BX.onCustomEvent(this,"onPopupClose",[this,t]),this.hideOverlay(),this.popupContainer.style.display="none",this.isCloseByEscBinded&&(BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!1),setTimeout(BX.proxy(this._close,this),0)}},BX.PopupWindow.prototype._close=function(){this.params.autoHide&&this.isAutoHideBinded&&(this.isAutoHideBinded=!1,BX.unbind(this.popupContainer,"click",this.cancelBubble),BX.unbind(document,"click",BX.proxy(this.close,this)))},BX.PopupWindow.prototype._onCloseIconClick=function(e){e=e||t.event,this.close(e),BX.PreventDefault(e)},BX.PopupWindow.prototype._onKeyUp=function(o){o=o||t.event,27==o.keyCode&&e(this.getZindex(),BX.proxy(this.close,this))},BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]),BX.unbindAll(this),BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),BX.unbind(document,"click",BX.proxy(this.close,this)),BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this)),BX.unbind(t,"resize",BX.proxy(this._onResizeWindow,this)),BX.remove(this.popupContainer),this.removeOverlay()},BX.PopupWindow.prototype.enterFullScreen=function(){BX.PopupWindow.fullscreenStatus?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():BX.browser.IsChrome()||BX.browser.IsSafari()?(this.contentContainer.webkitRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT),BX.bind(t,"webkitfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))):BX.browser.IsFirefox()&&(this.contentContainer.mozRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT),BX.bind(t,"mozfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this)))},BX.PopupWindow.prototype.eventFullScreen=function(e){BX.PopupWindow.fullscreenStatus?(BX.browser.IsChrome()||BX.browser.IsSafari()?BX.unbind(t,"webkitfullscreenchange",this.fullscreenBind):BX.browser.IsFirefox()&&BX.unbind(t,"mozfullscreenchange",this.fullscreenBind),BX.removeClass(this.contentContainer,"popup-window-fullscreen",[this.contentContainer]),BX.PopupWindow.fullscreenStatus=!1,BX.onCustomEvent(this,"onPopupFullscreenLeave"),this.adjustPosition()):(BX.addClass(this.contentContainer,"popup-window-fullscreen"),BX.PopupWindow.fullscreenStatus=!0,BX.onCustomEvent(this,"onPopupFullscreenEnter",[this.contentContainer]),this.adjustPosition())},BX.PopupWindow.prototype.adjustPosition=function(t){t&&"object"==typeof t&&(this.bindOptions=t);var e=this.getBindElementPos(this.bindElement);if(this.bindOptions.forceBindPosition||null==this.bindElementPos||e.top!=this.bindElementPos.top||e.left!=this.bindElementPos.left){this.bindElementPos=e;var o=e.windowSize?e.windowSize:BX.GetWindowInnerSize(),n=e.windowScroll?e.windowScroll:BX.GetWindowScrollPos(),i=e.popupWidth?e.popupWidth:this.popupContainer.offsetWidth,s=e.popupHeight?e.popupHeight:this.popupContainer.offsetHeight,p=BX.PopupWindow.getOption("angleTopOffset"),a=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&a+i+this.bordersWidth>=o.innerWidth+n.scrollLeft&&o.innerWidth+n.scrollLeft-i-this.bordersWidth>0){var u=a;a=o.innerWidth+n.scrollLeft-i-this.bordersWidth,this.isTopOrBottomAngle()&&this.setAngle({offset:u-a+this.angle.defaultOffset})}else this.isTopOrBottomAngle()&&this.setAngle({offset:this.angle.defaultOffset+(a<0?a:0)});a<0&&(a=0);var r=0;this.bindOptions.position&&"top"==this.bindOptions.position?(r=this.bindElementPos.top-s-this.offsetTop-(this.isBottomAngle()?p:0),r<0||!this.bindOptions.forceTop&&r<n.scrollTop?(r=this.bindElementPos.bottom+this.offsetTop,null!=this.angle&&(r+=p,this.setAngle({position:"top"}))):this.isTopAngle()?(r=r-p+BX.PopupWindow.getOption("positionTopXOffset"),this.setAngle({position:"bottom"})):r+=BX.PopupWindow.getOption("positionTopXOffset")):(r=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight(),!this.bindOptions.forceTop&&r+s>o.innerHeight+n.scrollTop&&this.bindElementPos.top-s-this.getAngleHeight()>=0?(r=this.bindElementPos.top-s,this.isTopOrBottomAngle()&&(r-=p,this.setAngle({position:"bottom"})),r+=BX.PopupWindow.getOption("positionTopXOffset")):this.isBottomAngle()&&(r+=p,this.setAngle({position:"top"}))),!this.parentPopup&&r<0&&(r=0),BX.adjust(this.popupContainer,{style:{top:r+"px",left:a+"px",zIndex:this.getZindex()}}),this.adjustOverlayZindex()}},BX.PopupWindow.prototype._onResizeWindow=function(t){this.isShown()&&(this.adjustPosition(),null!=this.overlay&&this.resizeOverlay())},BX.PopupWindow.prototype.move=function(t,e){var o=parseInt(this.popupContainer.style.left)+t,n=parseInt(this.popupContainer.style.top)+e;if("object"==typeof this.params.draggable&&this.params.draggable.restrict){!this.parentPopup&&o<0&&(o=0);var i=BX.GetWindowScrollSize(),s=this.popupContainer.offsetWidth,p=this.popupContainer.offsetHeight;o>i.scrollWidth-s&&(o=i.scrollWidth-s),n>i.scrollHeight-p&&(n=i.scrollHeight-p),!this.parentPopup&&n<0&&(n=0)}this.popupContainer.style.left=o+"px",this.popupContainer.style.top=n+"px"},BX.PopupWindow.prototype._startDrag=function(e){return e=e||t.event,BX.fixEventPageXY(e),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged=!1,BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this)),document.body.setCapture&&document.body.setCapture(),document.body.ondrag=BX.False,document.body.onselectstart=BX.False,document.body.style.cursor="move",document.body.style.MozUserSelect="none",this.popupContainer.style.MozUserSelect="none",BX.PreventDefault(e)},BX.PopupWindow.prototype._moveDrag=function(e){e=e||t.event,BX.fixEventPageXY(e),this.dragPageX==e.pageX&&this.dragPageY==e.pageY||(this.move(e.pageX-this.dragPageX,e.pageY-this.dragPageY),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged||(BX.onCustomEvent(this,"onPopupDragStart"),this.dragged=!0),BX.onCustomEvent(this,"onPopupDrag"))},BX.PopupWindow.prototype._stopDrag=function(t){return document.body.releaseCapture&&document.body.releaseCapture(),BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this)),document.body.ondrag=null,document.body.onselectstart=null,document.body.style.cursor="",document.body.style.MozUserSelect="",this.popupContainer.style.MozUserSelect="",BX.onCustomEvent(this,"onPopupDragEnd"),this.dragged=!1,BX.PreventDefault(t)},BX.PopupWindow.options={},BX.PopupWindow.defaultOptions={angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1e3,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:10,angleMinRight:10,angleMaxRight:10,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0},BX.PopupWindow.setOptions=function(t){if(t&&"object"==typeof t)for(var e in t)BX.PopupWindow.options[e]=t[e]},BX.PopupWindow.getOption=function(t,e){return"undefined"!=typeof BX.PopupWindow.options[t]?BX.PopupWindow.options[t]:"undefined"!=typeof e?e:BX.PopupWindow.defaultOptions[t]},BX.PopupWindowButton=function(t){this.popupWindow=null,this.params=t||{},this.text=this.params.text||"",this.id=this.params.id||"",this.className=this.params.className||"",this.events=this.params.events||{},this.contextEvents={};for(var e in this.events)this.contextEvents[e]=BX.proxy(this.events[e],this);this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})},BX.PopupWindowButton.prototype.render=function(){return this.buttonNode},BX.PopupWindowButton.prototype.setName=function(t){this.text=t||"",this.buttonNode&&(BX.cleanNode(this.buttonNode),BX.adjust(this.buttonNode,{text:this.text}))},BX.PopupWindowButton.prototype.setClassName=function(t){this.buttonNode&&(BX.type.isString(this.className)&&""!=this.className&&BX.removeClass(this.buttonNode,this.className),BX.addClass(this.buttonNode,t)),this.className=t},BX.PopupWindowButtonLink=function(t){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments),this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},text:this.text,events:this.contextEvents})},BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton),BX.PopupMenu={Data:{},currentItem:null,show:function(t,e,o,n){null!==this.currentItem&&this.currentItem.popupWindow.close(),this.currentItem=this.create(t,e,o,n),this.currentItem.popupWindow.show()},create:function(t,e,o,n){return this.Data[t]||(this.Data[t]=new BX.PopupMenuWindow(t,e,o,n)),this.Data[t]},getCurrentMenu:function(){return this.currentItem},getMenuById:function(t){return this.Data[t]?this.Data[t]:null},destroy:function(t){var e=this.getMenuById(t);e&&(this.currentItem==e&&(this.currentItem=null),e.popupWindow.destroy(),delete this.Data[t])}},BX.PopupMenuWindow=function(t,e,o,n){if(this.id=t,this.bindElement=e,this.menuItems=[],this.itemsContainer=null,o&&BX.type.isArray(o))for(var i=0;i<o.length;i++)this.__addMenuItem(o[i],null);this.params=n&&"object"==typeof n?n:{},this.popupWindow=this.__createPopup()},BX.PopupMenuWindow.prototype.__createItem=function(t){return t.delimiter?t.layout.item=BX.create("span",{props:{className:"popup-window-delimiter"}}):(t.layout.item=BX.create(t.href?"a":"span",{props:{className:"menu-popup-item"+(BX.type.isNotEmptyString(t.className)?" "+t.className:" menu-popup-no-icon")},attrs:{title:t.title?t.title:"",onclick:t.onclick&&BX.type.isString(t.onclick)?t.onclick:"",target:t.target?t.target:""},events:t.onclick&&BX.type.isFunction(t.onclick)?{click:BX.proxy(this.onItemClick,{obj:this,item:t})}:null,children:[BX.create("span",{props:{className:"menu-popup-item-icon"}}),t.layout.text=BX.create("span",{props:{className:"menu-popup-item-text"},html:t.text})]}),t.href&&(t.layout.item.href=t.href)),t},BX.PopupMenuWindow.prototype.__createPopup=function(){for(var t=[],e=0;e<this.menuItems.length;e++)this.__createItem(this.menuItems[e]),null!=this.menuItems[e].layout.hr&&t.push(this.menuItems[e].layout.hr),t.push(this.menuItems[e].layout.item);var o=new BX.PopupWindow("menu-popup-"+this.id,this.bindElement,{closeByEsc:"undefined"!=typeof this.params.closeByEsc&&this.params.closeByEsc,bindOptions:"object"==typeof this.params.bindOptions?this.params.bindOptions:{},angle:"undefined"!=typeof this.params.angle&&this.params.angle,zIndex:this.params.zIndex?this.params.zIndex:0,overlay:"object"==typeof this.params.overlay?this.params.overlay:null,autoHide:"undefined"==typeof this.params.autoHide||this.params.autoHide,offsetTop:this.params.offsetTop?this.params.offsetTop:1,offsetLeft:this.params.offsetLeft?this.params.offsetLeft:0,noAllPaddings:!0,content:BX.create("div",{props:{className:"menu-popup"},children:[this.itemsContainer=BX.create("div",{props:{className:"menu-popup-items"},children:t})]})});if(this.params&&this.params.events)for(var n in this.params.events)this.params.events.hasOwnProperty(n)&&BX.addCustomEvent(o,n,this.params.events[n]);return o},BX.PopupMenuWindow.prototype.onItemClick=function(e){e=e||t.event,this.item.onclick.call(this.obj,e,this.item)},BX.PopupMenuWindow.prototype.addMenuItem=function(t,e){var o=this.__addMenuItem(t,e);if(o<0)return!1;this.__createItem(t);var n=this.getMenuItem(e);return null!=n?(null==n.layout.hr&&(n.layout.hr=BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]}),this.itemsContainer.insertBefore(n.layout.hr,n.layout.item)),null!=t.layout.hr&&this.itemsContainer.insertBefore(t.layout.hr,n.layout.hr),this.itemsContainer.insertBefore(t.layout.item,n.layout.hr)):(null!=t.layout.hr&&this.itemsContainer.appendChild(t.layout.hr),this.itemsContainer.appendChild(t.layout.item)),!0},BX.PopupMenuWindow.prototype.__addMenuItem=function(t,e){if(!t||!t.delimiter&&!BX.type.isNotEmptyString(t.text)||t.id&&null!=this.getMenuItem(t.id))return-1;t.layout={item:null,text:null,hr:null};var o=this.getMenuItemPosition(e);return o>=0?this.menuItems=BX.util.insertIntoArray(this.menuItems,o,t):(this.menuItems.push(t),o=this.menuItems.length-1),o},BX.PopupMenuWindow.prototype.removeMenuItem=function(t){var e=this.getMenuItem(t);if(e){for(var o=0;o<this.menuItems.length;o++)if(this.menuItems[o]==e){this.menuItems=BX.util.deleteFromArray(this.menuItems,o);break}0==o?this.menuItems[0]&&(this.menuItems[0].layout.hr.parentNode.removeChild(this.menuItems[0].layout.hr),this.menuItems[0].layout.hr=null):e.layout.hr.parentNode.removeChild(e.layout.hr),e.layout.item.parentNode.removeChild(e.layout.item),e.layout.item=null}},BX.PopupMenuWindow.prototype.getMenuItem=function(t){for(var e=0;e<this.menuItems.length;e++)if(this.menuItems[e].id&&this.menuItems[e].id==t)return this.menuItems[e];return null},BX.PopupMenuWindow.prototype.getMenuItemPosition=function(t){if(t)for(var e=0;e<this.menuItems.length;e++)if(this.menuItems[e].id&&this.menuItems[e].id==t)return e;return-1},t.BXInputPopup=function(t){this.id=t.id||"bx-inp-popup-"+Math.round(1e6*Math.random()),this.handler=t.handler||!1,this.values=t.values||!1,this.pInput=t.input,this.bValues=!!this.values,this.defaultValue=t.defaultValue||"",this.openTitle=t.openTitle||"",this.className=t.className||"",this.noMRclassName=t.noMRclassName||"ec-no-rm",this.emptyClassName=t.noMRclassName||"ec-label";var e=this;this.curInd=!1,this.bValues?(this.pInput.onfocus=this.pInput.onclick=function(t){return this.value==e.defaultValue&&(this.value="",this.className=e.className),e.ShowPopup(),BX.PreventDefault(t)},this.pInput.onblur=function(){e.bShowed&&setTimeout(function(){e.ClosePopup(!0)},200),e.OnChange()}):(this.pInput.className=this.noMRclassName,this.pInput.onblur=BX.proxy(this.OnChange,this))},BXInputPopup.prototype={ShowPopup:function(){if(!this.bShowed){var t=this;if(!this.oPopup){for(var e,o=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}}),n=0,i=this.values.length;n<i;n++)e=o.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+n},text:this.values[n].NAME,events:{mouseover:function(){BX.addClass(this,"bxecplloc-over")},mouseout:function(){BX.removeClass(this,"bxecplloc-over")},click:function(){var e=this.id.substr("bxecmr_".length);t.pInput.value=t.values[e].NAME,t.curInd=e,t.OnChange(),t.ClosePopup(!0)}}})),this.values[n].DESCRIPTION&&(e.title=this.values[n].DESCRIPTION),this.values[n].CLASS_NAME&&BX.addClass(e,this.values[n].CLASS_NAME),this.values[n].URL&&e.appendChild(BX.create("A",{props:{href:this.values[n].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}));this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,content:o}),BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show(),this.pInput.select(),this.bShowed=!0,BX.onCustomEvent(this,"onInputPopupShow",[this])}},ClosePopup:function(t){this.bShowed=!1,""==this.pInput.value&&this.OnChange(),BX.onCustomEvent(this,"onInputPopupClose",[this]),t===!0&&this.oPopup.close()},OnChange:function(){var t=this.pInput.value;this.bValues&&(""==this.pInput.value||this.pInput.value==this.defaultValue?(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName,t=""):this.pInput.className=""),isNaN(parseInt(this.curInd))||this.curInd!==!1&&t!=this.values[this.curInd].NAME?this.curInd=!1:this.curInd=parseInt(this.curInd),BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,t]),this.handler&&"function"==typeof this.handler&&this.handler({ind:this.curInd,value:t})},Set:function(t,e,o){this.curInd=t,this.curInd!==!1?this.pInput.value=this.values[this.curInd].NAME:this.pInput.value=e,o!==!1&&this.OnChange()},Get:function(t){var e=!1;return"undefined"==typeof t&&(t=this.curInd),t!==!1&&this.values[t]&&(e=this.values[t].ID),e},GetIndex:function(t){for(var e=0,o=this.values.length;e<o;e++)if(this.values[e].ID==t)return e;return!1},Deactivate:function(t){""!=this.pInput.value&&this.pInput.value!=this.defaultValue||(t?(this.pInput.value="",this.pInput.className=this.noMRclassName):this.oEC.bUseMR&&(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName)),this.pInput.disabled=t}};var o=-1,n=null}}(window);
//# sourceMappingURL=maps/core_popup.min.js.map
