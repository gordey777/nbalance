!function(s){s.fn.manageLinkProfile=function(e,o){var r=this;return r.init=function(e){return this.each(function(){r.UI=s.extend({steps:{email:"#js-ow-sal-step2",password:"#js-ow-sal-step3"},submit:".js-ow-sal-submit",error:".js-ow-sal-error",result:"#js-ow-result-message"},e.ui),r.options=s.extend({},e.opts),r.userFields={},r.checkAjax=null,BX.addCustomEvent("registerExternalSuccess",function(s){window.location=window.location}),BX.addCustomEvent("registerExternalFail",function(e){r.userFields=e,s("#js-social-link").addClass("show"),s("body").toggleClass("oppened"),void 0!==e.EMAIL&&""!=e.EMAIL&&s(".js-ow-sal-email").val(e.EMAIL)}),s(r.UI.steps.email,r).find("form").validate({submitHandler:function(){r._stepEmail()},errorPlacement:function(s,e){s.appendTo(e.siblings(".js-input-error")),e.closest(".js-field-block").addClass("error")}}),s(r.UI.steps.password,r).find("form").validate({submitHandler:function(){r._stepPassword()},errorPlacement:function(s,e){s.appendTo(e.siblings(".js-input-error")),e.closest(".js-field-block").addClass("error")}})})},r._stepEmail=function(){var e=s(r.UI.steps.email,r),o=s(".js-ow-sal-email",e),a={ow_sal_check_email:"Y",sessid:BX.bitrix_sessid()};a[o.attr("name")]=o.val();var t={data:a,before:function(){s(r.UI.error,e).hide(),o.removeClass("error"),s(r.UI.submit,e).addClass("dotted")},onSuccess:function(t){s(r.UI.submit,e).removeClass("dotted"),"error"==t.status?(s(r.UI.error,e).html('<span class="error">'+t.message+"</span>").show(),o.addClass("error").closest(".js-field-block").addClass("error")):(r.userFields.EMAIL=a[o.attr("name")],e.hide(),s(r.UI.steps.password,r).show().find(r.UI.result).html(t.message),r.userFields.EMAIL=a.ow_sal_email,"user_exists"==t.status&&s(r.UI.steps.password,r).find(".js-ow-sal-link-to-user").val("Y"))},onError:function(o,a){s(r.UI.submit,e).removeClass("dotted"),s(r.UI.error,e).html("Приносим свои извинения. Сервис временно недоступен").show()}};r._ajaxRequest(t)},r._stepPassword=function(){var e=s(r.UI.steps.password,r),o=s(".js-ow-sal-password",e),a={ow_sal_link:"Y",sessid:BX.bitrix_sessid(),ow_sal_link_to_user:e.find(".js-ow-sal-link-to-user").val(),arFields:r.userFields};a[o.attr("name")]=o.val();var t={data:a,before:function(){s(r.UI.error,e).hide(),o.removeClass("error"),s(r.UI.submit,e).addClass("dotted")},onSuccess:function(a){s(r.UI.submit,e).removeClass("dotted"),"error"==a.status?(s(r.UI.error,e).html('<span class="error">'+a.message+"</span>").show(),o.addClass("error").closest(".js-field-block").addClass("error")):"refresh"==a.status&&(window.location=window.location)},onError:function(o,a){s(r.UI.submit,e).removeClass("dotted"),s(r.UI.error,e).html("Приносим свои извинения. Сервис временно недоступен").show()}};r._ajaxRequest(t)},r._ajaxRequest=function(e){null!=r.checkAjax&&r.checkAjax.abort(),e.before(),r.checkAjax=s.ajax({data:e.data,url:"/bitrix/components/oneway/socserv.auth.linkprofile/ajax.php",type:"POST",dataType:"json",success:function(s){e.onSuccess(s)},error:function(s,o){e.onError(s,o)}})},"string"==typeof e&&"_"!=e[0]&&"function"==typeof r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:r.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=maps/script(1).js.map
